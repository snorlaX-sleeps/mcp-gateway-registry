# =============================================================================
# MCP Gateway Registry - Environment Configuration Sample  
# =============================================================================
# Copy this file to .env and update with your actual values
# Never commit real credentials to version control

# =============================================================================
# REGISTRY CONFIGURATION
# =============================================================================

# Public URL where the MCP Gateway Registry is accessible
# For custom HTTPS domain: https://mcpgateway.mycorp.com
REGISTRY_URL=http://localhost

# Registry admin credentials
ADMIN_USER=admin
ADMIN_PASSWORD=your-secure-password-here

# =============================================================================
# Deployment Mode Configuration
# =============================================================================

# DEPLOYMENT_MODE controls how the registry integrates with the gateway/nginx
# Options:
#   - with-gateway (default): Full integration with nginx reverse proxy
#     - Nginx config is regenerated when servers are registered/deleted
#     - Frontend shows gateway authentication instructions
#   - registry-only: Registry operates as catalog/discovery service only
#     - Nginx config is NOT updated on server changes
#     - Frontend shows direct connection mode (proxy_pass_url)
#     - Use when registry is separate from gateway infrastructure
# Default: with-gateway (uncomment to change)
# DEPLOYMENT_MODE=with-gateway

# REGISTRY_MODE controls which features are enabled (informational - for UI feature flags)
# This setting affects the /api/config response which the frontend can use
# to show/hide navigation elements. Currently informational only - all APIs remain active.
# Options:
#   - full (default): All features enabled (mcp_servers, agents, skills, federation)
#   - skills-only: Only skills feature flag enabled
#   - mcp-servers-only: Only MCP server feature flag enabled
#   - agents-only: Only A2A agent feature flag enabled
# Note: with-gateway + skills-only is invalid and auto-corrects to registry-only + skills-only
# Default: full (uncomment to change)
# REGISTRY_MODE=full

# =============================================================================
# AUTH SERVER CONFIGURATION
# =============================================================================

# Internal auth server URL (for Docker network communication)
AUTH_SERVER_URL=http://auth-server:8888

# External auth server URL (public-facing, for browser redirects)
# For local development: http://localhost:8888
# For custom HTTPS domain: https://mcpgateway.mycorp.com
AUTH_SERVER_EXTERNAL_URL=http://localhost:8888

# =============================================================================
# NETWORK-TRUSTED API ACCESS (Enterprise Perimeter Security)
# =============================================================================
#
# Allow Registry API access without full token validation.
#
# Use case: Enterprise deployments where the MCP Gateway Registry operates
# within a secure network perimeter (VPC, private subnet, VPN, etc.)
#
# When enabled (true):
#   - Registry API endpoints (/api/*, /v0.1/*) use static token auth
#     instead of IdP-based JWT validation
#   - Clients must send: Authorization: Bearer <REGISTRY_API_TOKEN>
#   - Useful for trusted networks, CI/CD pipelines, and internal automation
#   - MCP Gateway server access STILL requires full IdP authentication
#
# When disabled (false, default):
#   - All endpoints require valid JWT tokens from the configured IdP
#   - Standard security posture
#
# Security considerations:
#   - Always set REGISTRY_API_TOKEN when enabling this feature
#   - Network-level security (firewalls, security groups) should be in place
#   - Audit logs will show "network-trusted" as auth method
#   - MCP server tool invocations remain fully protected by the IdP
#
# Default: false
REGISTRY_STATIC_TOKEN_AUTH_ENABLED=false

# Static API key for Registry API when REGISTRY_STATIC_TOKEN_AUTH_ENABLED=true.
# Clients must send this value as: Authorization: Bearer <token>
# If not set while static token auth is enabled, any Bearer value is accepted (less secure).
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
REGISTRY_API_TOKEN=

# =============================================================================
# FEDERATION STATIC TOKEN AUTH (Scoped Access for Peer Registries)
# =============================================================================
#
# Allow peer registries to access federation and peer management endpoints
# using a static Bearer token instead of OAuth2 JWT.
#
# IMPORTANT: This token only grants access to:
#   - /api/federation/* (federation export endpoints)
#   - /api/peers/* (peer management endpoints)
# It does NOT grant access to other registry APIs.
#
# When enabled (true):
#   - Federation/peer endpoints accept: Authorization: Bearer <FEDERATION_STATIC_TOKEN>
#   - Used for quick setup of peer-to-peer federation without OAuth2 infrastructure
#   - Audit logs will show "federation-static" as auth method
#
# When disabled (false, default):
#   - Federation endpoints require OAuth2 JWT with federation-service scope
#
# Default: false
FEDERATION_STATIC_TOKEN_AUTH_ENABLED=false

# Static token for federation API access.
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
FEDERATION_STATIC_TOKEN=

# Encryption key for storing federation tokens in MongoDB (required on importing registry).
# When peer configs contain federation_token, it is encrypted before storage using this key.
# Generate with: python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
FEDERATION_ENCRYPTION_KEY=

# =============================================================================
# AUTHENTICATION PROVIDER CONFIGURATION
# =============================================================================
# Choose authentication provider: 'cognito', 'keycloak', or 'entra'
AUTH_PROVIDER=keycloak

# =============================================================================
# KEYCLOAK CONFIGURATION (if AUTH_PROVIDER=keycloak)
# =============================================================================

# Keycloak server URL (internal URL for server-to-server communication)
# DO NOT CHANGE: This should always be http://keycloak:8080 for Docker network communication
KEYCLOAK_URL=http://keycloak:8080

# Keycloak external URL (for browser redirects)
# For local development: http://localhost:8080
# For custom HTTPS domain: https://mcpgateway.mycorp.com
KEYCLOAK_EXTERNAL_URL=http://localhost:8080

# Keycloak admin URL (for setup scripts - internal access)
# Typically http://localhost:8080 for local access to Keycloak admin
# For custom HTTPS domain: https://mcpgateway.mycorp.com
KEYCLOAK_ADMIN_URL=http://localhost:8080

# Keycloak realm name
KEYCLOAK_REALM=mcp-gateway

# Keycloak admin credentials (for initial setup)
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=your-secure-keycloak-admin-password

# Keycloak database password
KEYCLOAK_DB_PASSWORD=your-secure-db-password

# Keycloak client credentials for web authentication
# These are auto-generated when you run keycloak/setup/init-keycloak.sh
# To retrieve: Check script output or Keycloak Admin Console → Clients → Credentials tab
KEYCLOAK_CLIENT_ID=mcp-gateway-web
KEYCLOAK_CLIENT_SECRET=your-keycloak-client-secret-here

# Keycloak M2M client credentials for machine-to-machine authentication
# These are auto-generated when you run keycloak/setup/init-keycloak.sh
# To retrieve: Check script output or Keycloak Admin Console → Clients → Credentials tab
KEYCLOAK_M2M_CLIENT_ID=mcp-gateway-m2m
KEYCLOAK_M2M_CLIENT_SECRET=your-keycloak-m2m-secret-here

# Enable Keycloak in OAuth2 providers
KEYCLOAK_ENABLED=true

# Initial admin and test user passwords for Keycloak setup
INITIAL_ADMIN_PASSWORD=your-secure-keycloak-admin-password
INITIAL_USER_PASSWORD=your-secure-keycloak-user-password

# =============================================================================
# GATEWAY HOST CONFIGURATION
# =============================================================================

# Optional: Additional server names for nginx reverse proxy gateway access
# Use this to add custom domain names, public IPs, or private IPs to the nginx server_name directive
# Supports multiple names separated by spaces
#
# Examples:
#   - Custom domain: mcpgateway.example.com
#   - Public IP: 54.123.45.67
#   - Private IP: 10.0.1.42
#   - Multiple: mcpgateway.example.com 54.123.45.67
#   - Custom domain: mcpgateway.ddns.net
#
# Default: Empty (will auto-detect private IP if available)
# WARNING: HTTP access is not recommended for production. Use HTTPS with valid SSL certificates.
GATEWAY_ADDITIONAL_SERVER_NAMES=

# =============================================================================
# AMAZON COGNITO OAUTH2 CONFIGURATION (if AUTH_PROVIDER=cognito)
# =============================================================================

# AWS Configuration
AWS_REGION=us-east-1

# Amazon Cognito User Pool ID
# Format: {region}_{random_string}
COGNITO_USER_POOL_ID=us-east-1_XXXXXXXXX

# Cognito App Client ID
# Get this from Amazon Cognito console > User Pools > App Integration > App clients
COGNITO_CLIENT_ID=your_cognito_client_id_here

# Cognito App Client Secret
# Get this from Amazon Cognito console > User Pools > App Integration > App clients
COGNITO_CLIENT_SECRET=your_cognito_client_secret_here

# Enable Cognito in OAuth2 providers
COGNITO_ENABLED=false

# =============================================================================
# MICROSOFT ENTRA ID CONFIGURATION (if AUTH_PROVIDER=entra)
# =============================================================================

# Azure AD Tenant ID (Directory/tenant ID from Azure Portal)
# Format: GUID (e.g., 12345678-1234-1234-1234-123456789012)
# Get from: Azure Portal → Azure Active Directory → Overview → Tenant ID
ENTRA_TENANT_ID=your-tenant-id-here

# Entra ID Application (client) ID
# Format: GUID (e.g., 87654321-4321-4321-4321-210987654321)
# Get from: Azure Portal → App registrations → Your App → Application (client) ID
ENTRA_CLIENT_ID=your-client-id-here

# Entra ID Client Secret (Application secret value)
# Get from: Azure Portal → App registrations → Your App → Certificates & secrets
# NOTE: Copy the secret VALUE immediately after creation (not the secret ID)
ENTRA_CLIENT_SECRET=your-client-secret-here

# Enable Entra ID in OAuth2 providers (set to true when using Entra ID)
ENTRA_ENABLED=false

# Entra ID Login Base URL (optional - defaults to https://login.microsoftonline.com)
# Change this only if using a sovereign cloud (e.g., Azure Government, Azure China)
# Examples:
#   - Azure Public Cloud (default): https://login.microsoftonline.com
#   - Azure Government: https://login.microsoftonline.us
#   - Azure China: https://login.chinacloudapi.cn
#   - Azure Germany: https://login.microsoftonline.de
# ENTRA_LOGIN_BASE_URL=https://login.microsoftonline.com

# Azure AD Group Object IDs for authorization (configured in scopes.yml)
# Admin Group Example
ENTRA_GROUP_ADMIN_ID=your-admin-group-object-id-here
# Users Group Example
ENTRA_GROUP_USERS_ID=your-users-group-object-id-here

# =============================================================================
# GITHUB OAUTH2 CONFIGURATION
# =============================================================================

# GitHub OAuth App Client ID
# Get this from GitHub > Settings > Developer settings > OAuth Apps
GITHUB_CLIENT_ID=your_github_client_id_here

# GitHub OAuth App Client Secret
GITHUB_CLIENT_SECRET=your_github_client_secret_here

# Enable GitHub in OAuth2 providers
GITHUB_ENABLED=false

# =============================================================================
# GOOGLE OAUTH2 CONFIGURATION
# =============================================================================

# Google OAuth2 Client ID
# Get this from Google Cloud Console > APIs & Services > Credentials
GOOGLE_CLIENT_ID=your_google_client_id_here

# Google OAuth2 Client Secret
GOOGLE_CLIENT_SECRET=your_google_client_secret_here

# Enable Google in OAuth2 providers
GOOGLE_ENABLED=false

# =============================================================================
# APPLICATION SECURITY
# =============================================================================

# CRITICAL: CHANGE THIS SECRET KEY IMMEDIATELY!
# This is used for JWT token signing and session security
# Generate a strong, random 64-character string in production
# WARNING: Using the default value is a security risk!
SECRET_KEY=CHANGE-THIS-IMMEDIATELY-use-a-strong-random-key-in-production

# =============================================================================
# SESSION COOKIE CONFIGURATION
# =============================================================================

# Session cookie secure flag (HTTPS-only transmission)
# IMPORTANT: Set based on your environment:
#   - Local development (localhost via HTTP): Set to false
#   - Production with HTTPS: Set to true
#
# If set to true, cookies will ONLY be sent over HTTPS connections.
# Setting this to true on localhost (HTTP) will cause login to fail!
#
# Default: false (safe for local development)
# Production: MUST be true
SESSION_COOKIE_SECURE=false

# Session cookie domain (for cross-subdomain authentication)
# Leave unset or empty for single-domain deployments (RECOMMENDED for most cases)
# Set to domain with leading dot for cross-subdomain sharing
#
# Examples:
#   Single domain (mcpgateway.ddns.net): Leave unset or set to empty string
#     SESSION_COOKIE_DOMAIN=
#
#   Cross-subdomain (auth.example.com + registry.example.com): Set to .example.com
#     SESSION_COOKIE_DOMAIN=.example.com
#
#   Multi-level domains (registry.region-1.corp.company.internal): Set to your org domain
#     SESSION_COOKIE_DOMAIN=.corp.company.internal
#
# Default: Empty (cookie scoped to exact host only - safest option)
SESSION_COOKIE_DOMAIN=

# =============================================================================
# OAUTH TOKEN STORAGE CONFIGURATION
# =============================================================================

# Control whether OAuth provider tokens are stored in session cookies
# When enabled (true, default):
#   - OAuth access_token, refresh_token, and expiration stored in session
#   - May cause cookie size issues with large tokens (e.g., Microsoft Entra ID)
#
# When disabled (false):
#   - OAuth tokens NOT stored in session cookies
#   - Reduces cookie size significantly
#   - Recommended for Entra ID deployments experiencing cookie size errors
#
# Default: false (tokens are not used functionally, reduces cookie size)
OAUTH_STORE_TOKENS_IN_SESSION=false

# =============================================================================
# EXTERNAL MCP SERVER AUTH TOKENS (Auto-generated from OAuth flows)
# =============================================================================
# These tokens are automatically populated by the OAuth credential scripts
# Do not set these manually - they are managed by credentials-provider/

# ATLASSIAN_AUTH_TOKEN="auto_generated_by_oauth_flow"
# SRE_GATEWAY_AUTH_TOKEN="auto_generated_by_oauth_flow"

# Smithery API Key for accessing Smithery-hosted MCP servers
# Get this from https://smithery.ai/
SMITHERY_API_KEY=your_smithery_api_key_here

# =============================================================================
# AI/LLM CONFIGURATION
# =============================================================================

# Anthropic API Key for Claude models (required for agent functionality)
# Get this from https://console.anthropic.com/
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# =============================================================================
# SECURITY SCANNING CONFIGURATION (Cisco AI Defense Integration)
# =============================================================================

# Enable/disable security scanning for MCP servers
# When enabled, servers are scanned during registration for security threats
SECURITY_SCAN_ENABLED=true

# Automatically scan servers when they are registered
# Set to false to disable automatic scanning on registration
SECURITY_SCAN_ON_REGISTRATION=true

# Block (disable) servers that fail security scans
# When true, unsafe servers are automatically disabled
# When false, unsafe servers remain enabled but tagged
SECURITY_BLOCK_UNSAFE_SERVERS=true

# Analyzers to use for security scanning (comma-separated)
# Available: yara, llm, api
# - yara: Pattern matching with YARA rules (no API key required)
# - llm: LLM-as-a-judge evaluation (requires MCP_SCANNER_LLM_API_KEY)
# - api: Cisco AI Defense inspect API (requires Cisco credentials)
SECURITY_ANALYZERS=yara

# Security scan timeout in seconds (default: 300 = 5 minutes)
SECURITY_SCAN_TIMEOUT=60

# Add 'security-pending' tag to servers that fail security scan
# This helps identify servers awaiting security review
SECURITY_ADD_PENDING_TAG=true

# MCP Security Scanner LLM API Key (optional - only needed for LLM-based security analysis)
# Default analyzer is YARA (no API key required)
# To use LLM analyzer: ./cli/service_mgmt.sh add config.json yara,llm
# Get OpenAI API key from https://platform.openai.com/api-keys
MCP_SCANNER_LLM_API_KEY=your_openai_api_key_here

# =============================================================================
# EMBEDDINGS CONFIGURATION
# =============================================================================

# Embeddings provider: 'sentence-transformers' (local) or 'litellm' (cloud-based)
# Default: sentence-transformers (no API key required)
EMBEDDINGS_PROVIDER=litellm

# Model name for embeddings generation
# For sentence-transformers: model name from Hugging Face (e.g., all-MiniLM-L6-v2)
# For litellm: provider-prefixed model (e.g., bedrock/amazon.titan-embed-text-v1,
#              openai/text-embedding-3-small, cohere/embed-english-v3.0)
EMBEDDINGS_MODEL_NAME=bedrock/amazon.titan-embed-text-v2:0

# Embedding dimension (must match the model's output dimension)
# all-MiniLM-L6-v2: 384
# text-embedding-3-small: 1536
# amazon.titan-embed-text-v1: 1536
# cohere/embed-english-v3.0: 1024
EMBEDDINGS_MODEL_DIMENSIONS=1024

# LiteLLM-specific settings (only used when EMBEDDINGS_PROVIDER=litellm)
# API key for cloud embeddings provider (provider-specific)
# For OpenAI: Get from https://platform.openai.com/api-keys
# For Cohere: Get from https://dashboard.cohere.com/api-keys
# For Bedrock: Not used - configure AWS credentials via standard methods (see below)
# EMBEDDINGS_API_KEY=your_api_key_here

# Optional: Custom API base URL for embeddings provider
# EMBEDDINGS_API_BASE=https://api.custom-endpoint.com

# AWS region for Amazon Bedrock embeddings (only needed for Bedrock)
# Note: For Bedrock authentication, use standard AWS credential chain:
#       - IAM roles (recommended for EC2/EKS)
#       - Environment variables (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY)
#       - AWS credentials file (~/.aws/credentials)
# EMBEDDINGS_AWS_REGION=us-east-1

# =============================================================================
# A2A AGENT SECURITY SCANNING CONFIGURATION
# =============================================================================

# Enable/disable security scanning for A2A agents
# When enabled, agents are scanned during registration for security threats
AGENT_SECURITY_SCAN_ENABLED=true

# Automatically scan agents when they are registered
# Set to false to disable automatic scanning on registration
AGENT_SECURITY_SCAN_ON_REGISTRATION=true

# Block (disable) agents that fail security scans
# When true, unsafe agents are automatically disabled
# When false, unsafe agents remain enabled but tagged
AGENT_SECURITY_BLOCK_UNSAFE_AGENTS=true

# Analyzers to use for agent security scanning (comma-separated)
# Available: yara, spec, heuristic, llm, endpoint
# - yara: Pattern matching with YARA rules (no API key required)
# - spec: A2A protocol specification validation (no API key required)
# - heuristic: Logic-based threat detection (no API key required)
# - llm: LLM-as-a-judge evaluation (requires A2A_SCANNER_LLM_API_KEY)
# - endpoint: Dynamic endpoint security testing (requires live agent)
AGENT_SECURITY_ANALYZERS=yara,spec

# Agent security scan timeout in seconds (default: 60 = 1 minute)
AGENT_SECURITY_SCAN_TIMEOUT=60

# Add 'security-pending' tag to agents that fail security scan
# This helps identify agents awaiting security review
AGENT_SECURITY_ADD_PENDING_TAG=true

# A2A Security Scanner LLM API Key (optional - only needed for LLM-based agent analysis)
# Default analyzers are YARA and Spec (no API key required)
# Get Azure OpenAI API key from https://portal.azure.com/
A2A_SCANNER_LLM_API_KEY=your_azure_openai_api_key_here

# =============================================================================
# CONTAINER REGISTRY CREDENTIALS (for CI/CD and local builds)
# =============================================================================

# Docker Hub credentials for publishing container images
# Get these from https://hub.docker.com/settings/security
DOCKERHUB_USERNAME=your_dockerhub_username
DOCKERHUB_TOKEN=your_dockerhub_access_token

# GitHub Container Registry credentials (optional - for publishing to ghcr.io)
# The GITHUB_TOKEN is automatically provided in GitHub Actions
# For local builds, generate a Personal Access Token with packages:write scope
# Get this from https://github.com/settings/tokens
# GITHUB_USERNAME=your_github_username
# GITHUB_TOKEN=your_github_personal_access_token

# # Container registry organization names
# DOCKERHUB_ORG=mcpgateway
# GITHUB_ORG=agentic-community

# =============================================================================
# EXTERNAL REGISTRY CONFIGURATION
# =============================================================================

# Comma-separated list of tags that identify external registry servers
# These tags are used by the frontend to separate internal MCP servers from
# external registry integrations (e.g., Anthropic, Workday, etc.)
# Servers tagged with these values will appear in the "External Registries" tab
# Default: anthropic-registry,workday-asor
EXTERNAL_REGISTRY_TAGS=anthropic-registry,workday-asor

# =============================================================================
# STORAGE BACKEND CONFIGURATION
# =============================================================================

# Storage Backend Selection
# Options:
#   "file" - Uses JSON files (simple, local development)
#   "documentdb" - Uses Amazon DocumentDB or MongoDB (production, with native vector search)
#   "mongodb-ce" - Uses MongoDB Community Edition 8.2 (local dev, application-level vector search)
# For production deployments, DocumentDB is recommended for scalability and concurrent access
# Options: file, mongodb-ce, documentdb
STORAGE_BACKEND=mongodb-ce

# DocumentDB Configuration (used when STORAGE_BACKEND=documentdb or mongodb-ce)
# Amazon DocumentDB (MongoDB-compatible) or MongoDB connection settings

# For local MongoDB CE (mongodb-ce backend):
# Authentication with SCRAM-SHA-256 (stronger than SCRAM-SHA-1)
DOCUMENTDB_HOST=mongodb
DOCUMENTDB_PORT=27017
DOCUMENTDB_DATABASE=mcp_registry
DOCUMENTDB_USERNAME=admin
DOCUMENTDB_PASSWORD=admin
DOCUMENTDB_USE_TLS=false
DOCUMENTDB_NAMESPACE=default

# For AWS DocumentDB (documentdb backend):
# Uses SCRAM-SHA-1 (AWS DocumentDB v5.0 limitation)
# DOCUMENTDB_HOST=your-documentdb-cluster.cluster-xxxxx.us-east-1.docdb.amazonaws.com
# DOCUMENTDB_PORT=27017
# DOCUMENTDB_DATABASE=mcp_registry
# DOCUMENTDB_USERNAME=your_username
# DOCUMENTDB_PASSWORD=your_password
# DOCUMENTDB_USE_TLS=true
# DOCUMENTDB_TLS_CA_FILE=global-bundle.pem
# DOCUMENTDB_USE_IAM=false
# DOCUMENTDB_REPLICA_SET=rs0
# DOCUMENTDB_READ_PREFERENCE=secondaryPreferred
# DOCUMENTDB_NAMESPACE=default

# =============================================================================
# ADDITIONAL CONFIGURATION
# =============================================================================

# Optional: Set specific Cognito domain if using custom domain
# COGNITO_DOMAIN=your-custom-domain.auth.{region}.amazoncognito.com

# Optional: Additional service-specific environment variables
# Add any additional configuration variables your deployment requires

# =============================================================================
# AUDIT LOGGING CONFIGURATION
# =============================================================================

# Enable/disable audit logging
# When enabled, all API and MCP requests are logged to MongoDB for compliance
# Default: true
AUDIT_LOG_ENABLED=true

# Audit log retention period in days
# Logs older than this are automatically deleted via MongoDB TTL index
# Common values: 7 (dev), 30 (standard), 90 (compliance)
# Default: 7
AUDIT_LOG_MONGODB_TTL_DAYS=7

# =============================================================================
# FEDERATION PEER SYNC CONFIGURATION
# =============================================================================
# OAuth2 client credentials for peer-to-peer registry federation
# Run keycloak/setup/setup-federation-service-account.sh to create the client
# FEDERATION_TOKEN_ENDPOINT=http://keycloak:8080/realms/mcp-gateway/protocol/openid-connect/token
# FEDERATION_CLIENT_ID=federation-peer-m2m
# FEDERATION_CLIENT_SECRET=your-federation-client-secret
